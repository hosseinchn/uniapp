<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enginuity - انجمن گفت‌و‌گو</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
        body{background:#f5f7fb;padding:18px;padding-bottom:85px;}
        .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
        .header h1{color:#1a237e;font-size:23px;}
        .newpost-btn{
            background:#4e5fe0;color:#fff;border:none;border-radius:7px;padding:8px 18px;font-weight:bold;
            font-size:14px;box-shadow:0 1px 7px rgba(78,95,224,0.10);cursor:pointer;transition:.17s;
        }
        .newpost-btn:hover{background:#2635af;}
        .tabs-container{display:flex;gap:9px;margin-bottom:15px;}
        .tab{
            flex:1;padding:12px 0;text-align:center;background:#fff;color:#1a237e;border-radius:8px;
            box-shadow:0 1px 6px rgba(50,70,224,0.05);font-size:13px;font-weight:bold;cursor:pointer;transition:.17s;
        }
        .tab.active{background:#4e5fe0;color:#fff;}
        .forum-posts{margin-top:0;display:flex;flex-direction:column;gap:15px;}
        .post-card{
            background:#fff;border-radius:12px;padding:16px 10px 13px 10px;margin-bottom:4px;
            box-shadow:0 2px 8px rgba(78,95,224,.07);display:flex;flex-direction:column;gap:6px;
        }
        .post-header{display:flex;align-items:center;gap:0 10px;}
        .user-avater{width:39px;height:39px;border-radius:50%;background:#ededfa;display:flex;align-items:center;justify-content:center;}
        .user-avater i{font-size:19px;color:#4e5fe0;}
        .post-user-info{flex:1;}
        .post-author{font-weight:bold;font-size:15px;color:#222;}
        .post-meta{font-size:11px;color:#888;margin-top:2px;}
        .post-body{font-size:14px;color:#333;margin:6px 0 8px 0;line-height:1.7;}
        .post-actions{display:flex;gap:15px;}
        .action-btn{color:#555;font-size:14px;display:flex;align-items:center;gap:4px;cursor:pointer;transition:color .17s;}
        .action-btn.liked{color:#4e5fe0;}
        .action-btn i{font-size:15px;}
        .compose-modal{
            position:fixed;z-index:22;top:0;right:0;bottom:0;left:0;background:rgba(0,0,48,.18);display:none;
            justify-content:center;align-items:center;
        }
        .modal-content{
            background:#fff;border-radius:10px;padding:22px 14px;min-width:260px;max-width:410px;width:98vw;
            box-shadow:0 2px 16px rgba(58,72,234,0.08);}
        .modal-content h2{font-size:19px;color:#1a237e;margin-bottom:8px;}
        .modal-content input,.modal-content textarea{
            width:100%;padding:7px 9px 9px 9px;border:1px solid #d4d9ff;border-radius:7px;margin-bottom:10px;
            font-size:15px;}
        .modal-content textarea{resize:vertical;height:80px;}
        .modal-actions{display:flex;gap:12px;justify-content:flex-end;}
        .modal-btn{background:#4e5fe0;color:#fff;border:none;border-radius:7px;padding:6px 20px;font-size:14px;font-weight:bold;cursor:pointer;}
        .modal-btn.cancel{background:#eaeaf5;color:#2835a2;}
        .no-posts{color:#999;text-align:center;margin:24px 0;font-size:16px;}
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;display:flex;justify-content:space-around;
            padding:15px 0 10px 0;box-shadow:0 -2px 10px rgba(0,0,0,0.08);}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:#777;text-decoration:none;font-size:13px;}
        .nav-item i{font-size:23px;margin-bottom:2px;}
        .nav-item.active{color:#4e5fe0;}
        @media(max-width:630px){.header,.tabs-container{flex-direction:column;gap:5px;}}
        @media(max-width:420px){.modal-content{padding:8px 1vw;}}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body>
    <div class="header">
        <h1>انجمن گفت‌و‌گو</h1>
        <button class="newpost-btn" onclick="showComposeModal()">+ ارسال پست جدید</button>
    </div>
    <div class="tabs-container">
        <div class="tab active" onclick="showTab('all')">همه</div>
        <div class="tab" onclick="showTab('questions')">سوالات</div>
        <div class="tab" onclick="showTab('news')">اخبار</div>
    </div>
    <div class="forum-posts" id="postList">
        <!-- JS -->
    </div>

    <!-- پاپ‌آپ ثبت پست جدید -->
    <div class="compose-modal" id="composeModal">
        <div class="modal-content">
            <h2>پست جدید</h2>
            <input id="postTitle" placeholder="عنوان (اختیاری)">
            <textarea id="postBody" placeholder="متن خود را بنویسید..."></textarea>
            <select id="postCategory">
                <option value="question">سوال</option>
                <option value="news">خبر</option>
                <option value="general">بحث آزاد</option>
            </select>
            <div class="modal-actions">
                <button class="modal-btn" onclick="submitPost()">ارسال</button>
                <button class="modal-btn cancel" onclick="closeComposeModal()">انصراف</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i><span>خانه</span></a>
        <a href="courses.html" class="nav-item"><i class="fas fa-book"></i><span>دوره‌ها</span></a>
        <a href="forum.html" class="nav-item active"><i class="fas fa-comments"></i><span>انجمن</span></a>
        <a href="profile.html" class="nav-item"><i class="fas fa-user"></i><span>پروفایل</span></a>
    </div>

    <script>
        // --- داده نمونه اگر هنوز انجمن به سرور وصل نشد:
        const DUMMY_POSTS = [
            {
                id:1,
                user:{name:'نیما احمدی', icon:'user'},
                time:'۱ ساعت پیش',
                category:'question',
                title:'تفاوت for و while؟',
                body:'کسی می‌تونه توضیح بده فرق حلقه for و while چیه؟ همیشه موقع الگوریتم گیج میشم.',
                likes:13, liked:true, comments:6
            },{
                id:2,
                user:{name:'سارا محمدی', icon:'user'},
                time:'۲ ساعت پیش',
                category:'news',
                title:'شروع مسابقه جدید',
                body:'مسابقه کدنویسی پاییز از دیروز شروع شد! کسی ثبت نام کرده؟',
                likes:7, liked:false, comments:3
            },{
                id:3,
                user:{name:'استاد علیزاده', icon:'user-tie'},
                time:'امروز',
                category:'news',
                title: 'مهلت پروژه',
                body:'یادآوری: پروژه عملی تا پنجشنبه تمدید شد.',
                likes:21, liked:false, comments:2
            }
        ];
        let posts = [];
        let currTab = 'all';

        function getUserName(){
            // در کار پروژه شما : fetch user by localStorage userId
            try {
                const userStr = localStorage.getItem('userProfile');
                if(userStr) return JSON.parse(userStr).username;
            }catch{}
            return "کاربر مهمان";
        }

        // نمایش پست‌ها با فیلتر تب
        function renderPosts(){
            const box = document.getElementById('postList');
            let filtered = posts;
            if(currTab==='questions') filtered = posts.filter(p=>p.category==='question');
            if(currTab==='news') filtered = posts.filter(p=>p.category==='news');
            if(filtered.length===0){
                box.innerHTML = '<div class="no-posts">پستی برای نمایش وجود ندارد!</div>';
                return;
            }
            box.innerHTML = filtered.map(p=>
                `<div class="post-card">
                    <div class="post-header">
                        <div class="user-avater"><i class="fas fa-${p.user.icon||'user'}"></i></div>
                        <div class="post-user-info">
                            <div class="post-author">${p.user.name||"ناشناس"}</div>
                            <div class="post-meta">${p.time}</div>
                        </div>
                    </div>
                    <div class="post-body">${p.title?'<b>'+p.title+'</b><br/>':''}${p.body||''}</div>
                    <div class="post-actions">
                        <div class="action-btn${p.liked?' liked':''}" onclick="likePost(${p.id})"><i class="fa fa-thumbs-up"></i>${p.likes||0}</div>
                        <div class="action-btn"><i class="fa fa-comment"></i>${p.comments||0}</div>
                        <!--<div class="action-btn"><i class="fa fa-share"></i>اشتراک</div>-->
                    </div>
                </div>`
            ).join('');
        }

        function showTab(tab){
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            if(tab==='all') document.querySelectorAll('.tab')[0].classList.add('active');
            if(tab==='questions') document.querySelectorAll('.tab')[1].classList.add('active');
            if(tab==='news') document.querySelectorAll('.tab')[2].classList.add('active');
            currTab = tab;
            renderPosts();
        }

        function likePost(id){
            let p = posts.find(p=>p.id===id);
            if(!p) return;
            p.liked = !p.liked;
            p.likes += p.liked ? 1 : -1;
            renderPosts();
            // اینجا درخواست به سرور برای ذخیره لایک هم می‌تونه اضافه شود
        }

        // Compose modal logic
        function showComposeModal(){
            document.getElementById('composeModal').style.display='flex';
        }
        function closeComposeModal(){
            document.getElementById('composeModal').style.display='none';
            document.getElementById('postTitle').value='';
            document.getElementById('postBody').value='';
        }
        function submitPost(){
            const title = document.getElementById('postTitle').value.trim();
            const body = document.getElementById('postBody').value.trim();
            const category = document.getElementById('postCategory').value;
            if(!body){
                alert('متن پست را وارد کنید.');
                return;
            }
            // منشأ کاربر را (در پروژه واقعی از داده سرور و localStorage استفاده شود)
            const newPost = {
                id: Date.now(),
                user: { name:getUserName(), icon:'user' },
                time: 'لحظاتی پیش',
                category,title,body,
                likes:0,liked:false,comments:0
            };
            posts.unshift(newPost);
            closeComposeModal();
            renderPosts();
            // -- در پروژه واقعی: با fetch یک POST به /forum بدهید
        }

        window.onload = function(){
            const userId = localStorage.getItem('userId');
            if(!userId){ window.location.href = "LoginPage.html"; return;}
            // در پروژه واقعی: fetch('http://localhost:3001/forum')
            // اینجا داده نمونه
            posts = [...DUMMY_POSTS];
            renderPosts();
        }
    </script>
</body>
</html>
