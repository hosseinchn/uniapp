<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Enginuity - Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- ÙÙˆÙ†Øªâ€ŒØ¢Ø³Ù… Ùˆ Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø«Ù„ Ù‚Ø¨Ù„ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    /* ğŸ“Œ Ù‡Ù…ÙˆÙ† Ø§Ø³ØªØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ Ø´Ù…Ø§ */
    /* ... Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ØªÙˆÙ† Ø§ÛŒÙ†Ø¬Ø§ ... */
    body { background-color: #f5f7fb; padding: 20px; padding-bottom: 70px; font-family: Arial, sans-serif;}
    .header {display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
    .header h1 {color:#1a237e;font-size:24px;}
    .back-button {color:#4e5fe0;text-decoration:none;display:flex;align-items:center;}
    .filter-container {display:flex;gap:10px;margin-bottom:20px;overflow-x:auto;padding-bottom:5px;}
    .filter-button {background:white;border:1px solid #ddd;border-radius:20px;padding:8px 15px;font-size:14px;white-space:nowrap;}
    .filter-button.active {background:#4e5fe0;color:white;border-color:#4e5fe0;}
    .user-position {background:#4e5fe0;color:white;border-radius:12px;padding:15px;display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    .position-info {display:flex;align-items:center;}
    .position-number {font-size:18px;font-weight:bold;margin-left:15px;background:white;color:#4e5fe0;width:30px;height:30px;border-radius:50%;display:flex;justify-content:center;align-items:center;}
    .position-name {font-weight:bold;}
    .position-points {font-weight:bold;}
    .leaderboard-container {background:white;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
    .leaderboard-item {display:flex;justify-content:space-between;align-items:center;padding:15px;border-bottom:1px solid #eee;}
    .leaderboard-item:last-child {border-bottom:none;}
    .leaderboard-rank {font-weight:bold;margin-left:15px;color:#333;width:30px;text-align:center;}
    .leaderboard-rank.top {background:#FFD700;color:white;width:30px;height:30px;border-radius:50%;display:flex;justify-content:center;align-items:center;}
    .leaderboard-rank.top2 {background:#C0C0C0;color:white;width:30px;height:30px;border-radius:50%;display:flex;justify-content:center;align-items:center;}
    .leaderboard-rank.top3 {background:#CD7F32;color:white;width:30px;height:30px;border-radius:50%;display:flex;justify-content:center;align-items:center;}
    .leaderboard-user {display:flex;align-items:center;flex:1;}
    .user-avatar {width:40px;height:40px;border-radius:50%;background:#f0f4ff;display:flex;justify-content:center;align-items:center;margin-left:10px;}
    .user-avatar i {color:#4e5fe0;}
    .user-name {font-weight:bold;color:#333;}
    .leaderboard-score {font-weight:bold;color:#4e5fe0;}
    .bottom-nav {position:fixed;bottom:0;left:0;right:0;background:white;display:flex;justify-content:space-around;padding:15px 0;box-shadow:0 -2px 10px rgba(0,0,0,0.1);}
    .nav-item {display:flex;flex-direction:column;align-items:center;color:#777;text-decoration:none;font-size:12px;}
    .nav-item i {font-size:24px;margin-bottom:5px;}
    .nav-item.active {color:#4e5fe0;}
  </style>
</head>
<body>
  <div class="header">
      <a href="profile.html" class="back-button">
          <i class="fas fa-arrow-right"></i>
      </a>
      <h1>Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</h1>
      <div></div>
  </div>
  <div class="filter-container">
      <button class="filter-button active">Ù‡ÙØªÚ¯ÛŒ</button>
      <button class="filter-button">Ù…Ø§Ù‡Ø§Ù†Ù‡</button>
      <button class="filter-button">Ú©Ù„ÛŒ</button>
      <button class="filter-button">Ø¯ÙˆØ³ØªØ§Ù†</button>
      <button class="filter-button">Ø¯ÙˆØ±Ù‡: Ø§ØµÙˆÙ„ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ</button>
  </div>
  <div class="user-position" id="user-position" style="display:none;"></div>
  <div class="leaderboard-container" id="leaderboard"></div>
  <div class="bottom-nav">
      <a href="dashboard.html" class="nav-item">
          <i class="fas fa-home"></i>
          <span>Ø®Ø§Ù†Ù‡</span>
      </a>
      <a href="courses.html" class="nav-item">
          <i class="fas fa-book"></i>
          <span>Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§</span>
      </a>
      <a href="search.html" class="nav-item">
          <i class="fas fa-search"></i>
          <span>Ø¬Ø³ØªØ¬Ùˆ</span>
      </a>
      <a href="profile.html" class="nav-item active">
          <i class="fas fa-user"></i>
          <span>Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
      </a>
  </div>
  <script>
    // ØªØ§Ø¨Ø¹ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±: (Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ùˆ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ùˆ ... Ù‡Ù… Ø§Ù…ØªÛŒØ§Ø² Ø±Ø§ Ø¨Ø³Ø§Ø²ÛŒØ¯)
    function calculateUserPoints(user) {
      // Ø¬Ù…Ø¹ Ú©Ù„ valueÙ‡Ø§ÛŒ progress (Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù‡Ø± Ù…Ù†Ø·Ù‚ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø²Ù†ÛŒ)
      let sum = 0;
      if (user.progress && Array.isArray(user.progress)) {
        sum = user.progress.reduce((a, p) => a + (p.value || 0), 0);
      }
      // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø§Ø² achievements/gameRecords/quizRecords/etc Ù‡Ù… Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯Ù‡ÛŒ
      return sum;
    }

    function getUserIdFromStorage() {
      return localStorage.getItem('userId') || null;
    }

    function formatRankingNum(idx) {
      if(idx === 0) return 'top';
      if(idx === 1) return 'top2';
      if(idx === 2) return 'top3';
      return '';
    }

    // ÙˆØ§Ú©Ø´ÛŒ Ùˆ Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Ø±Ù†Ú©ÛŒÙ†Ú¯
    fetch('http://localhost:3001/users')
      .then(res => res.json())
      .then(users => {
        // Ø³Ø§Ø®Øª Ø¢Ø±Ø§ÛŒÙ‡ Ø´Ø§Ù…Ù„ Ù†Ø§Ù…ØŒ Ø¢ÙˆØ§ØªØ§Ø± (ÛŒØ§ icon)ØŒ Ø§Ù…ØªÛŒØ§Ø² Ùˆ id
        const leaderboard = users.map(u => ({
          id: u.id,
          name: u.fullname || u.username,
          avatar: u.avatar,
          points: calculateUserPoints(u)
        }))
        // Ø¨Ù‡â€ŒØªØ±ØªÛŒØ¨ Ø§Ù…ØªÛŒØ§Ø² Ù†Ø²ÙˆÙ„ÛŒ
        .sort((a, b) => b.points - a.points);

        // Ù†Ù…Ø§ÛŒØ´ Ø±ØªØ¨Ù‡ Ø®ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
        const userId = getUserIdFromStorage();
        if(userId) {
          const userIdx = leaderboard.findIndex(u => u.id === userId);
          if (userIdx >= 0) {
            const you = leaderboard[userIdx];
            document.getElementById("user-position").style.display = '';
            document.getElementById("user-position").innerHTML = `
              <div class="position-info">
                <div class="position-number">${userIdx + 1}</div>
                <div class="position-name">Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø´Ù…Ø§</div>
              </div>
              <div class="position-points">${you.points} Ø§Ù…ØªÛŒØ§Ø²</div>
            `;
          }
        }

        // Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ Ø±Ù†Ú©ÛŒÙ†Ú¯
        let html = '';
        leaderboard.forEach((u, idx) => {
          html += `
            <div class="leaderboard-item">
              <div class="leaderboard-user">
                <div class="leaderboard-rank ${formatRankingNum(idx)}">${idx + 1}</div>
                <div class="user-avatar">
                  ${u.avatar ? `<img src="${u.avatar}" style="width:100%;height:100%;border-radius:50%;">`: `<i class="fas fa-user"></i>`}
                </div>
                <div class="user-name">${u.name}</div>
              </div>
              <div class="leaderboard-score">${u.points} Ø§Ù…ØªÛŒØ§Ø²</div>
            </div>
          `;
        });
        document.getElementById('leaderboard').innerHTML = html;
      })
      .catch(err => {
        document.getElementById('leaderboard').innerHTML = `<div style="color:#c33;padding:16px;">Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</div>`;
      });
  </script>
</body>
</html>
